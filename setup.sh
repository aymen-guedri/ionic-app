#!/bin/bash\n\n# Smart Parking App Setup Script\n# This script sets up the complete Smart Parking application\n\necho \"ðŸš— Smart Parking App Setup\"\necho \"=========================\"\n\n# Colors for output\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\n# Function to print colored output\nprint_status() {\n    echo -e \"${BLUE}[INFO]${NC} $1\"\n}\n\nprint_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $1\"\n}\n\nprint_warning() {\n    echo -e \"${YELLOW}[WARNING]${NC} $1\"\n}\n\nprint_error() {\n    echo -e \"${RED}[ERROR]${NC} $1\"\n}\n\n# Check if Node.js is installed\nif ! command -v node &> /dev/null; then\n    print_error \"Node.js is not installed. Please install Node.js 18+ first.\"\n    exit 1\nfi\n\n# Check Node.js version\nNODE_VERSION=$(node -v | cut -d'v' -f2 | cut -d'.' -f1)\nif [ \"$NODE_VERSION\" -lt 18 ]; then\n    print_error \"Node.js version 18+ is required. Current version: $(node -v)\"\n    exit 1\nfi\n\nprint_success \"Node.js $(node -v) is installed\"\n\n# Check if npm is installed\nif ! command -v npm &> /dev/null; then\n    print_error \"npm is not installed. Please install npm first.\"\n    exit 1\nfi\n\nprint_success \"npm $(npm -v) is installed\"\n\n# Install dependencies\nprint_status \"Installing dependencies...\"\nnpm install\n\nif [ $? -eq 0 ]; then\n    print_success \"Dependencies installed successfully\"\nelse\n    print_error \"Failed to install dependencies\"\n    exit 1\nfi\n\n# Install additional dependencies for QR code and ImageKit\nprint_status \"Installing additional dependencies...\"\nnpm install qrcode @types/qrcode @capacitor/barcode-scanner\n\nif [ $? -eq 0 ]; then\n    print_success \"Additional dependencies installed\"\nelse\n    print_warning \"Some additional dependencies may have failed to install\"\nfi\n\n# Create environment file if it doesn't exist\nif [ ! -f \".env\" ]; then\n    print_status \"Creating environment file...\"\n    cp .env.example .env\n    print_warning \"Please update the .env file with your actual configuration values\"\nelse\n    print_status \"Environment file already exists\"\nfi\n\n# Install ImageKit server dependencies\nprint_status \"Setting up ImageKit server...\"\nif [ ! -f \"package-imagekit.json\" ]; then\n    cat > package-imagekit.json << EOF\n{\n  \"name\": \"smart-parking-imagekit-server\",\n  \"version\": \"1.0.0\",\n  \"description\": \"ImageKit authentication server for Smart Parking\",\n  \"main\": \"imagekit-server.js\",\n  \"scripts\": {\n    \"start\": \"node imagekit-server.js\",\n    \"dev\": \"nodemon imagekit-server.js\"\n  },\n  \"dependencies\": {\n    \"express\": \"^4.18.2\",\n    \"imagekit\": \"^4.1.3\",\n    \"cors\": \"^2.8.5\",\n    \"dotenv\": \"^16.3.1\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^3.0.1\"\n  }\n}\nEOF\n    print_success \"ImageKit server package.json created\"\nfi\n\n# Install ImageKit server dependencies\nnpm install --prefix . express imagekit cors dotenv nodemon\n\n# Setup Firebase (if firebase-tools is installed)\nif command -v firebase &> /dev/null; then\n    print_status \"Firebase CLI detected. Setting up Firebase...\"\n    \n    # Initialize Firebase if not already done\n    if [ ! -f \"firebase.json\" ]; then\n        print_status \"Initializing Firebase project...\"\n        firebase init\n    else\n        print_status \"Firebase already initialized\"\n    fi\n    \n    # Deploy Firestore rules\n    print_status \"Deploying Firestore rules...\"\n    firebase deploy --only firestore:rules\n    \n    # Deploy Cloud Functions (if functions directory exists)\n    if [ -d \"functions\" ]; then\n        print_status \"Installing Cloud Functions dependencies...\"\n        cd functions\n        npm install\n        cd ..\n        \n        print_status \"Deploying Cloud Functions...\"\n        firebase deploy --only functions\n    fi\nelse\n    print_warning \"Firebase CLI not installed. Please install it with: npm install -g firebase-tools\"\nfi\n\n# Setup Capacitor\nprint_status \"Setting up Capacitor...\"\nnpx cap sync\n\nif [ $? -eq 0 ]; then\n    print_success \"Capacitor sync completed\"\nelse\n    print_warning \"Capacitor sync failed. You may need to run 'npx cap sync' manually later\"\nfi\n\n# Build the project\nprint_status \"Building the project...\"\nnpm run build\n\nif [ $? -eq 0 ]; then\n    print_success \"Project built successfully\"\nelse\n    print_error \"Build failed. Please check for errors and try again\"\n    exit 1\nfi\n\n# Create startup scripts\nprint_status \"Creating startup scripts...\"\n\n# Create start-dev.sh\ncat > start-dev.sh << 'EOF'\n#!/bin/bash\necho \"Starting Smart Parking Development Environment...\"\n\n# Start ImageKit server in background\necho \"Starting ImageKit server...\"\nnode imagekit-server.js &\nIMAGEKIT_PID=$!\n\n# Start Ionic dev server\necho \"Starting Ionic development server...\"\nnpm run dev &\nIONIC_PID=$!\n\n# Function to cleanup on exit\ncleanup() {\n    echo \"Stopping servers...\"\n    kill $IMAGEKIT_PID 2>/dev/null\n    kill $IONIC_PID 2>/dev/null\n    exit 0\n}\n\n# Trap SIGINT and SIGTERM\ntrap cleanup SIGINT SIGTERM\n\necho \"Development environment started!\"\necho \"- Ionic app: http://localhost:8100\"\necho \"- ImageKit server: http://localhost:3001\"\necho \"Press Ctrl+C to stop all servers\"\n\n# Wait for background processes\nwait\nEOF\n\nchmod +x start-dev.sh\n\n# Create production start script\ncat > start-prod.sh << 'EOF'\n#!/bin/bash\necho \"Starting Smart Parking Production Environment...\"\n\n# Start ImageKit server\necho \"Starting ImageKit server...\"\nNODE_ENV=production node imagekit-server.js &\nIMAGEKIT_PID=$!\n\n# Serve built files (you might want to use a proper web server like nginx)\necho \"Starting web server...\"\nnpx serve -s dist -l 8080 &\nWEB_PID=$!\n\n# Function to cleanup on exit\ncleanup() {\n    echo \"Stopping servers...\"\n    kill $IMAGEKIT_PID 2>/dev/null\n    kill $WEB_PID 2>/dev/null\n    exit 0\n}\n\n# Trap SIGINT and SIGTERM\ntrap cleanup SIGINT SIGTERM\n\necho \"Production environment started!\"\necho \"- Web app: http://localhost:8080\"\necho \"- ImageKit server: http://localhost:3001\"\necho \"Press Ctrl+C to stop all servers\"\n\n# Wait for background processes\nwait\nEOF\n\nchmod +x start-prod.sh\n\nprint_success \"Startup scripts created\"\n\n# Create README for setup\ncat > SETUP.md << 'EOF'\n# Smart Parking App Setup Guide\n\n## Prerequisites\n- Node.js 18+\n- npm or yarn\n- Firebase CLI (optional but recommended)\n- Android Studio (for Android development)\n- Xcode (for iOS development, macOS only)\n\n## Quick Start\n\n1. **Clone and setup:**\n   ```bash\n   git clone <repository-url>\n   cd smart-parking\n   ./setup.sh\n   ```\n\n2. **Configure environment:**\n   - Copy `.env.example` to `.env`\n   - Update all configuration values in `.env`\n\n3. **Firebase Setup:**\n   - Create a Firebase project\n   - Enable Authentication, Firestore, Storage, and Cloud Messaging\n   - Download `google-services.json` (Android) and `GoogleService-Info.plist` (iOS)\n   - Update Firebase config in `.env`\n\n4. **ImageKit Setup:**\n   - Create an ImageKit account\n   - Get your public key, private key, and URL endpoint\n   - Update ImageKit config in `.env`\n\n5. **Start development:**\n   ```bash\n   ./start-dev.sh\n   ```\n\n## Mobile Development\n\n### Android\n```bash\nnpx cap add android\nnpx cap sync android\nnpx cap open android\n```\n\n### iOS\n```bash\nnpx cap add ios\nnpx cap sync ios\nnpx cap open ios\n```\n\n## Features Implemented\n\nâœ… **Core Features:**\n- User authentication (Firebase Auth)\n- Interactive parking map with 3D visualization\n- Real-time parking spot status\n- Reservation system with admin approval\n- QR code generation and scanning\n- Push notifications (FCM)\n- Geolocation services\n- Image management (ImageKit)\n- Admin panel for management\n\nâœ… **Advanced Features:**\n- Loyalty points system\n- Multi-tier user system\n- Real-time updates (Firestore)\n- Offline support\n- Responsive design\n- Dark/light theme support\n- Multi-language support (ready)\n\nâœ… **Backend Services:**\n- Firebase Cloud Functions\n- Firestore security rules\n- Automated notifications\n- Analytics generation\n- Payment processing (ready)\n\n## Configuration Files\n\n- `.env` - Environment variables\n- `firebase.json` - Firebase configuration\n- `firestore.rules` - Database security rules\n- `capacitor.config.ts` - Capacitor configuration\n\n## Scripts\n\n- `npm run dev` - Start development server\n- `npm run build` - Build for production\n- `./start-dev.sh` - Start full development environment\n- `./start-prod.sh` - Start production environment\n\n## Deployment\n\n1. **Web Deployment:**\n   ```bash\n   npm run build\n   firebase deploy --only hosting\n   ```\n\n2. **Mobile App Store:**\n   - Build signed APK/AAB for Android\n   - Build and archive for iOS App Store\n\n## Support\n\nFor issues and questions, please check the documentation or create an issue in the repository.\nEOF\n\nprint_success \"Setup documentation created (SETUP.md)\"\n\n# Final instructions\necho \"\"\necho \"ðŸŽ‰ Smart Parking App Setup Complete!\"\necho \"=====================================\"\necho \"\"\nprint_status \"Next steps:\"\necho \"1. Update the .env file with your actual configuration values\"\necho \"2. Set up Firebase project and update Firebase config\"\necho \"3. Set up ImageKit account and update ImageKit config\"\necho \"4. Run './start-dev.sh' to start the development environment\"\necho \"\"\nprint_status \"Available commands:\"\necho \"- ./start-dev.sh    - Start development environment\"\necho \"- ./start-prod.sh   - Start production environment\"\necho \"- npm run dev       - Start only Ionic dev server\"\necho \"- npm run build     - Build for production\"\necho \"\"\nprint_success \"Setup completed successfully! ðŸš—\"\necho \"\"\nprint_warning \"Don't forget to:\"\necho \"- Configure your .env file\"\necho \"- Set up Firebase project\"\necho \"- Set up ImageKit account\"\necho \"- Install Firebase CLI: npm install -g firebase-tools\"\necho \"\"\necho \"Happy coding! ðŸŽ‰\"